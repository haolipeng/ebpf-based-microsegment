# 实施任务

## 1. 数据结构
- [x] 1.1 定义 `policy_key` 结构（5 元组）
- [x] 1.2 定义 `policy_value` 结构（action、priority、rule_id、hit_count）
- [x] 1.3 定义策略操作枚举（ALLOW、DENY、LOG）

## 2. eBPF 映射配置
- [x] 2.1 为策略创建 HASH 映射（最大 10k 条目）
- [x] 2.2 配置键和值类型
- [x] 2.3 添加 SEC(".maps") 注释

## 3. 策略匹配逻辑
- [x] 3.1 实现策略查找函数
- [x] 3.2 从流密钥提取策略密钥
- [x] 3.3 处理策略命中（返回操作）
- [x] 3.4 处理策略未命中（默认操作）
- [x] 3.5 递增命中计数器

## 4. 通配符支持
- [x] 4.1 支持 0.0.0.0 表示任何源 IP
- [x] 4.2 支持 0.0.0.0 表示任何目标 IP
- [x] 4.3 支持端口 0 表示任何端口
- [x] 4.4 协议匹配

## 5. 用户空间策略管理
- [x] 5.1 在 Go 中实现 PolicyManager
- [x] 5.2 添加 AddPolicy() 方法
- [x] 5.3 添加 DeletePolicy() 方法
- [x] 5.4 添加 ListPolicies() 方法
- [x] 5.5 IP 地址解析和转换

## 6. 集成和测试
- [x] 6.1 与会话跟踪集成
- [x] 6.2 在会话中缓存策略决策
- [x] 6.3 测试精确匹配
- [x] 6.4 测试通配符匹配
- [x] 6.5 性能测试

**状态**：所有任务于 2025-10-30 完成

