# 实施任务

## 1. 数据结构
- [x] 1.1 定义用于 5 元组匹配的 `flow_key` 结构
- [x] 1.2 定义带跟踪字段的 `session_value` 结构
- [x] 1.3 添加会话状态枚举（NEW、ESTABLISHED、CLOSED）
- [x] 1.4 添加 TCP 状态机枚举

## 2. eBPF 映射配置
- [x] 2.1 创建最大 100k 条目的 LRU_HASH 映射
- [x] 2.2 配置键和值类型
- [x] 2.3 添加 SEC(".maps") 注释

## 3. 会话查找逻辑
- [x] 3.1 通过流密钥实现会话查找
- [x] 3.2 处理缓存命中路径（返回缓存的策略）
- [x] 3.3 处理缓存未命中路径（创建新会话）

## 4. 会话管理
- [x] 4.1 实现会话创建函数
- [x] 4.2 实现会话更新函数（时间戳、计数器）
- [x] 4.3 添加 TCP 状态跟踪逻辑
- [x] 4.4 自动 LRU 驱逐（内置）

## 5. 集成
- [x] 5.1 与数据包解析集成
- [x] 5.2 与策略执行集成
- [x] 5.3 添加统计跟踪
- [x] 5.4 通过 bpf2go 生成 Go 绑定

## 6. 测试
- [x] 6.1 单元测试会话创建
- [x] 6.2 测试缓存命中/未命中场景
- [x] 6.3 验证 LRU 驱逐
- [x] 6.4 性能测试

**状态**：所有任务于 2025-10-30 完成

